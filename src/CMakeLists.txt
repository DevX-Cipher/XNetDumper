cmake_minimum_required(VERSION 3.10)
project(XNetDumper)

SET(X_PROJECT_VERSION 0.0.1 CACHE INTERNAL "X_PROJECT_VERSION")
SET(X_MACOSX_BUNDLE_GUI_IDENTIFIER com.example.xnetdumper CACHE INTERNAL "X_MACOSX_BUNDLE_GUI_IDENTIFIER")

add_subdirectory(../dep/XCppfilt XCppfilt)
add_subdirectory(../dep/XCapstone XCapstone)
add_subdirectory(../dep/XArchive XArchive)
add_subdirectory(../dep/XYara XYara)
add_subdirectory(gui xnetdumper)

if(WIN32)
    string(REPLACE "\\" "/" CMAKE_PREFIX_PATH ${CMAKE_PREFIX_PATH})
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION "./")
    install (DIRECTORY ../dep/Detect-It-Easy/db_custom DESTINATION "./")
    install (DIRECTORY ../dep/XInfoDB/info DESTINATION "./")
    install (DIRECTORY ../dep/XStyles/qss DESTINATION "./")
    install (DIRECTORY ../dep/XYara/yara_rules DESTINATION "./")
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION "./")
    install (FILES ../dep/signatures/crypto.db DESTINATION "./signatures")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Widgets.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Gui.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Core.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5OpenGL.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Svg.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Sql.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Script.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5ScriptTools.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Network.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/platforms/qwindows.dll DESTINATION platforms)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qjpeg.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qtiff.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qico.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qgif.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/sqldrivers/qsqlite.dll DESTINATION sqldrivers)
else()
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/Detect-It-Easy/db_custom DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/XInfoDB/info DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/XStyles/qss DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/XYara/yara_rules DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (FILES ../dep/signatures/crypto.db DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper/signatures)
endif()

# TODO translation

set(CPACK_SOURCE_GENERATOR "ZIP")
include(CPack)
