cmake_minimum_required(VERSION 3.10)

include(../dep/build_tools/cmake/deploy.cmake)
file (STRINGS ${PROJECT_SOURCE_DIR}/release_version.txt X_PROJECT_VERSION)

#set(CPACK_SOURCE_GENERATOR "ZIP")
set(CPACK_INCLUDE_TOPLEVEL_DIRECTORY OFF)
set(CPACK_OUTPUT_FILE_PREFIX packages)
set(CPACK_PACKAGE_INSTALL_DIRECTORY "XNetDumper")
set(CPACK_PACKAGE_INSTALL_REGISTRY_KEY "XNetDumper")
set(CPACK_PACKAGE_VENDOR "ntinfo")
set(CPACK_RESOURCE_FILE_LICENSE ${PROJECT_SOURCE_DIR}/LICENSE)
set(CPACK_RESOURCE_FILE_README ${PROJECT_SOURCE_DIR}/README.md)
include(CPack)

project(XNetDumper VERSION ${X_PROJECT_VERSION} LANGUAGES CXX)

SET(X_MACOSX_BUNDLE_GUI_IDENTIFIER com.example.xnetdumper CACHE INTERNAL "X_MACOSX_BUNDLE_GUI_IDENTIFIER")

add_subdirectory(../dep/XCppfilt XCppfilt)
add_subdirectory(../dep/XCapstone XCapstone)
add_subdirectory(../dep/XArchive XArchive)
add_subdirectory(../dep/XYara XYara)
add_subdirectory(gui xnetdumper)

if(WIN32)
    string(REPLACE "\\" "/" CMAKE_PREFIX_PATH ${CMAKE_PREFIX_PATH})
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION "./")
    install (DIRECTORY ../dep/Detect-It-Easy/db_custom DESTINATION "./")
    install (DIRECTORY ../dep/XInfoDB/info DESTINATION "./")
    install (DIRECTORY ../dep/XStyles/qss DESTINATION "./")
    install (DIRECTORY ../dep/XYara/yara_rules DESTINATION "./")
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION "./")
    install (FILES ../dep/signatures/crypto.db DESTINATION "./signatures")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Widgets.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Gui.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Core.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5OpenGL.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Svg.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Sql.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Script.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5ScriptTools.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/bin/Qt5Network.dll DESTINATION "./")
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/platforms/qwindows.dll DESTINATION platforms)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qjpeg.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qtiff.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qico.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/imageformats/qgif.dll DESTINATION imageformats)
    install (FILES ${CMAKE_PREFIX_PATH}/plugins/sqldrivers/qsqlite.dll DESTINATION sqldrivers)

    if(MSVC)
        deploy_msvc()
    endif()
else()
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/Detect-It-Easy/db_custom DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/XInfoDB/info DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/XStyles/qss DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/XYara/yara_rules DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (DIRECTORY ../dep/Detect-It-Easy/db DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper)
    install (FILES ../dep/signatures/crypto.db DESTINATION ${CMAKE_INSTALL_LIBDIR}/xnetdumper/signatures)
endif()

# TODO translation


